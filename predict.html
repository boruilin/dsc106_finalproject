<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Try It Yourself: Stress Forecast</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      padding: 40px;
      max-width: 600px;
      margin: auto;
      background: #e8f0ff; /* Matches previous page background */
      color: #222;
    }

    h1 {
      text-align: center;
      color: #2d77ff;
      font-size: 2em;
    }

    p {
      text-align: center;
      font-size: 1.1em;
      margin-bottom: 10px;
    }

    form {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      padding: 30px;
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    input {
      padding: 12px;
      font-size: 1em;
      border: 1px solid #ccc;
      border-radius: 6px;
      transition: border 0.2s;
    }

    input:focus {
      border-color: #2d77ff;
      outline: none;
    }

    button {
      padding: 12px;
      background: #2d77ff;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 1em;
      cursor: pointer;
      transition: background 0.3s;
    }

    button:hover {
      background: #1e5fd9;
    }

    #result {
      margin-top: 20px;
      font-size: 1.2em;
      font-weight: bold;
      text-align: center;
    }

    .nav {
      margin-top: 40px;
      text-align: center;
    }

    .nav a {
      margin: 0 12px;
      color: #2d77ff;
      text-decoration: none;
      font-weight: bold;
    }

    .nav a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <h1>üß™ Try It Yourself</h1>
  <p>Enter your average physiological values during the exam to get your stress forecast and match:</p>

  <form id="predict-form">
    <input type="number" step="0.1" id="hr" placeholder="Average Heart Rate (BPM)" required />
    <input type="number" step="0.01" id="eda" placeholder="Average EDA (¬µS)" required />
    <input type="number" step="0.1" id="temp" placeholder="Average TEMP (¬∞F)" required />
    <button type="submit">Predict</button>
  </form>

  <div id="result"></div>

  <div class="nav">
    <a href="index.html">‚¨ÖÔ∏è Back to Dashboard</a>
    <a href="story.html">‚¨ÖÔ∏è Back to Story</a>
    <a href="survey.html">üîÅ Restart Survey</a>
  </div>

  <script>
    const studentData = [
      { student: "S2", exam: "Final", HR: 98.2, EDA: 0.72, TEMP: 29.5 },
      { student: "S4", exam: "Midterm2", HR: 103.4, EDA: 0.69, TEMP: 28.9 },
      { student: "S6", exam: "Midterm1", HR: 91.5, EDA: 0.43, TEMP: 31.1 },
      { student: "S8", exam: "Final", HR: 87.0, EDA: 0.22, TEMP: 30.4 }
    ];
  
    function calculatePoints(hr, eda, tempC) {
      let points = 0;
  
      // HR tiers
      if (hr < 80) points += 0;
      else if (hr < 100) points += 1;
      else if (hr < 120) points += 2;
      else points += 3;
  
      // EDA tiers
      if (eda < 0.2) points += 0;
      else if (eda < 0.5) points += 1;
      else if (eda < 1.0) points += 2;
      else points += 3;
  
      // TEMP tiers (in Celsius)
      if (tempC > 32) points += 2;
      else if (tempC >= 30) points += 1;
      else if (tempC < 28) points += 3;
      else points += 2;
  
      return points;
    }
  
    function mapPointsToStress(points) {
      if (points <= 2) return 20 + points * 5;
      if (points <= 4) return 35 + (points - 2) * 5;
      if (points <= 6) return 50 + (points - 4) * 7.5;
      if (points <= 8) return 65 + (points - 6) * 10;
      return 90;
    }
  
    function calculateDistance(user, record) {
      return Math.sqrt(
        Math.pow(user.hr - record.HR, 2) +
        Math.pow(user.eda - record.EDA, 2) +
        Math.pow(user.temp - record.TEMP, 2)
      );
    }
  
    document.getElementById("predict-form").addEventListener("submit", function (e) {
      e.preventDefault();
  
      const hr = parseFloat(document.getElementById("hr").value);
      const eda = parseFloat(document.getElementById("eda").value);
      const tempF = parseFloat(document.getElementById("temp").value);
      const tempC = (tempF - 32) * 5/9;
  
      const points = calculatePoints(hr, eda, tempC);
      const stressScore = mapPointsToStress(points);
  
      const userInput = { hr, eda, temp: tempC };
      let bestMatch = null;
      let minDist = Infinity;
  
      for (const record of studentData) {
        const dist = calculateDistance(userInput, record);
        if (dist < minDist) {
          minDist = dist;
          bestMatch = record;
        }
      }
  
      document.getElementById("result").textContent =
        `üîç Your stress forecast: ${stressScore.toFixed(1)}%. ` +
        `Closest match: ${bestMatch.student} during ${bestMatch.exam}.`;
    });
  </script>
  